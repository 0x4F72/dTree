function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.dTree=t()}(this,function(){"use strict";var e=function(){function e(t,n,r){_classCallCheck(this,e),e.DEBUG_LEVEL=r.debug?1:0,this.root=t,this.siblings=n,this.opts=r,this.allNodes=this._flatten(this.root);var i=_.filter(this.allNodes,function(e){return!e.hidden});this.nodeSize=r.callbacks.nodeSize(i,r.nodeWidth,r.callbacks.textRenderer)}return _createClass(e,[{key:"create",value:function(){var e=this.opts,t=(this.allNodes,this.nodeSize),n=e.width+e.margin.left+e.margin.right,r=e.height+e.margin.top+e.margin.bottom,i=d3.behavior.zoom().scaleExtent([.1,10]).on("zoom",_.bind(function(){a.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")},this)),a=this.svg=d3.select(e.target).append("svg").attr("width",n).attr("height",r).call(i).append("g").attr("transform","translate("+n/2+","+e.margin.top+")");i.translate([n/2,e.margin.top]),this.tree=d3.layout.tree().nodeSize([2*t[0],2*t[1]]),this.tree.separation(function(e,t){return e.hidden||t.hidden?.3:.6}),this._update(this.root)}},{key:"_update",value:function(e){var t=this.opts,n=(this.allNodes,this.nodeSize),r=this.tree.nodes(e),i=0;r.length>1&&(i=r[1].y),_.forEach(r,function(e){e.y=e.y-i/2});var a=this.tree.links(r);this.svg.selectAll(".link").data(a).enter().append("path").attr("class",t.styles.linage).attr("d",this._elbow);var r=this.svg.selectAll(".node").data(r).enter();this._linkSiblings(),this.svg.selectAll(".sibling").data(this.siblings).enter().append("path").attr("class",t.styles.marriage).attr("d",this._siblingLine),r.append("foreignObject").attr("display",function(e){return e.hidden?"none":""}).attr("x",function(e){return e.x-n[0]/2+"px"}).attr("y",function(e){return e.y-n[1]/2+"px"}).attr("width",n[0]+"px").attr("height",n[1]+"px").attr("id",function(e){return e.id}).html(function(e){return e.hidden?null:t.callbacks.nodeRenderer(e.name,e.x,e.y,n[0],n[1],e.extra,e.id,e["class"],e.textClass,t.callbacks.textRenderer)}).on("click",function(e){e.hidden||t.callbacks.nodeClick(e.name,e.extra,e.id)})}},{key:"_flatten",value:function(e){function t(e){e.children&&e.children.forEach(t),e.id||(e.id=++r),n.push(e)}var n=[],r=0;return t(e),n}},{key:"_elbow",value:function(e,t){if(e.target.noParent)return"M0,0L0,0";var n=e.target.y+.5*(e.source.y-e.target.y),r=[{x:e.target.x,y:e.target.y},{x:e.target.x,y:n},{x:e.source.x,y:e.source.y}],i=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("step-after");return i(r)}},{key:"_linkSiblings",value:function(){var e=this.allNodes;_.forEach(this.siblings,function(t){var n=e.filter(function(e){return t.source.id==e.id}),r=e.filter(function(e){return t.target.id==e.id});t.source.x=n[0].x,t.source.y=n[0].y,t.target.x=r[0].x,t.target.y=r[0].y})}},{key:"_siblingLine",value:function(e,t){var n=e.target.y+.5*(e.source.y-e.target.y),r=[{x:e.source.x,y:e.source.y},{x:e.target.x,y:n},{x:e.target.x,y:e.target.y}],i=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("step-after");return i(r)}}],[{key:"_nodeSize",value:function(e,t,n){var r=0,i=0;return _.forEach(e,function(e){var a=document.createElement("div");a.style.marginLeft="5px",a.style.paddingTop="5px",a.style.visibility="hidden",a.style.maxWidth=t+"px";var s=n(e.name,e.extra,e.textClass);a.innerHTML=s,document.body.appendChild(a),i=Math.max(i,a.offsetHeight),r=Math.max(r,a.clientWidth),document.body.removeChild(a)}),[t,i]}},{key:"_nodeRenderer",value:function(e,t,n,r,i,a,s,o,l,d){var c="";return c+="<div ",c+='style="height:100%;width:100%;" ',c+='class="'+o+'" ',c+='id="node'+s+'">\n',c+=d(e,a,l),c+="</div>"}},{key:"_textRenderer",value:function(e,t,n){var r="";return r+="<p ",r+='align="center" ',r+='class="'+n+'">\n',r+=e,r+="</p>\n"}},{key:"_debug",value:function(t){e.DEBUG_LEVEL>0&&console.log(t)}}]),e}(),t={VERSION:"0.7.0",init:function(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=_.defaultsDeep(n||{},{target:"#graph",debug:!1,width:600,height:600,callbacks:{nodeClick:function(e,t,n){},nodeRenderer:function(t,n,r,i,a,s,o,l,d,c){return e._nodeRenderer(t,n,r,i,a,s,o,l,d,c)},nodeSize:function(t,n,r){return e._nodeSize(t,n,r)},nodeSorter:function(e,t,n,r){return 0},textRenderer:function(t,n,r){return e._textRenderer(t,n,r)}},margin:{top:0,right:0,bottom:0,left:0},nodeWidth:100,styles:{node:"node",linage:"linage",marriage:"marriage",text:"nodeText"}}),t=this._preprocess(t,r),i=new e(t.root,t.siblings,r);i.create()},_preprocess:function(e,n){var r=[],i=0,a={name:"",id:i++,hidden:!0,children:[]},s=function o(e,s){var l={name:e.name,id:i++,hidden:!1,children:[],extra:e.extra,textClass:e.textClass?e.textClass:n.styles.text,"class":e["class"]?e["class"]:n.styles.node};s==a&&(l.noParent=!0);for(var d=0;d<e.depthOffset;d++){var c={name:"",id:i++,hidden:!0,children:[],noParent:l.noParent};s.children.push(c),s=c}if(t._sortPersons(e.children,n),_.forEach(e.children,function(e){o(e,l)}),e.marriage){var u={name:"",id:i++,hidden:!0,noParent:!0,children:[],extra:e.marriage.extra},h=e.marriage.spouse,f={name:h.name,id:i++,hidden:!1,noParent:!0,children:[],textClass:h.textClass?h.textClass:n.styles.text,"class":h["class"]?h["class"]:n.styles.node,extra:h.extra},g=t._sortPersons([l,f],n);s.children.push(g[0],u,g[1]),t._sortPersons(e.marriage.children,n),_.forEach(e.marriage.children,function(e){o(e,u)}),r.push({source:{id:l.id},target:{id:f.id}})}else s.children.push(l)};return _.forEach(e,function(e){s(e,a)}),{root:a,siblings:r}},_sortPersons:function(e,t){return void 0!=e&&e.sort(function(e,n){return t.callbacks.nodeSorter(e.name,e.extra,n.name,n.extra)}),e}};return t});
//# sourceMappingURL=dTree.min.js.map
