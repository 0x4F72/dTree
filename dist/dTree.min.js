function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.dTree=e()}(this,function(){"use strict";var t=function(){function t(e,n,r){_classCallCheck(this,t),this.root=e,this.siblings=n,this.opts=r,this.allNodes=this._flatten(this.root),this.nodeSize=this._calculateNodeSize()}return _createClass(t,[{key:"create",value:function(){var t=this.opts,e=(this.allNodes,this.nodeSize),n=d3.behavior.zoom().scaleExtent([.1,10]).on("zoom",_.bind(function(){r.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")},this)),r=this.svg=d3.select(t.target).append("svg").attr("width",t.width+t.margin.left+t.margin.right).attr("height",t.height+t.margin.top+t.margin.bottom).call(n).append("g").attr("transform","translate("+t.margin.left+","+t.margin.top+")");this.tree=d3.layout.tree().nodeSize(e),this.tree.separation(function(t,e){return t.hidden||e.hidden?.3:.6}),this._update(this.root)}},{key:"_update",value:function(t){var e=this.opts,n=(this.allNodes,this.nodeSize),r=this.tree.nodes(t),a=0;r.length>1&&(a=r[1].y),_.forEach(r,function(t){t.y=t.y-a/2});var i=this.tree.links(r);this.svg.selectAll(".link").data(i).enter().append("path").attr("class",e.styles.linage).attr("d",this._elbow);var r=this.svg.selectAll(".node").data(r).enter();this._linkSiblings(),this.svg.selectAll(".sibling").data(this.siblings).enter().append("path").attr("class",e.styles.marriage).attr("d",this._siblingLine),r.append("rect").attr("class",function(t){return t["class"]?t["class"]:e.styles.nodes}).attr("width",n[0]/2).attr("height",n[1]/3).attr("id",function(t){return t.id}).attr("display",function(t){return t.hidden?"none":""}).attr("x",function(t){return t.x-n[0]/4}).attr("y",function(t){return t.y-n[1]/6}).on("click",function(t){e.callbacks.nodeClick(t.name,t.extra,t.id)}),r.append("text").text(function(t){return e.callbacks.text(t.name,t.extra,t.id)}).attr("class",function(t){return t.textClass?t.textClass:e.styles.text}).attr("x",function(t){return t.x-n[0]/4+5}).attr("y",function(t){return t.y+4}).on("click",function(t){e.callbacks.nodeClick(t.name,t.extra,t.id)})}},{key:"_flatten",value:function(t){function e(t){t.children&&t.children.forEach(e),t.id||(t.id=++r),n.push(t)}var n=[],r=0;return e(t),n}},{key:"_elbow",value:function(t,e){if(t.target.noParent)return"M0,0L0,0";var n=t.target.y+.5*(t.source.y-t.target.y),r=[{x:t.target.x,y:t.target.y},{x:t.target.x,y:n},{x:t.source.x,y:t.source.y}],a=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("step-after");return a(r)}},{key:"_linkSiblings",value:function(){var t=this.allNodes;_.forEach(this.siblings,function(e){var n=t.filter(function(t){return e.source.id==t.id}),r=t.filter(function(t){return e.target.id==t.id});e.source.x=n[0].x,e.source.y=n[0].y,e.target.x=r[0].x,e.target.y=r[0].y})}},{key:"_siblingLine",value:function(t,e){var n=t.target.y+.5*(t.source.y-t.target.y),r=[{x:t.source.x,y:t.source.y},{x:t.target.x,y:n},{x:t.target.x,y:t.target.y}],a=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("step-after");return a(r)}},{key:"_calculateNodeSize",value:function(){var t="";return _.forEach(this.allNodes,function(e){e.name.length>t.length&&(t=e.name)}),[10*t.length+10,5*t.length]}}]),t}(),e={version:"0.2.3",init:function(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=_.defaultsDeep(n||{},{target:"#graph",width:600,height:600,callbacks:{nodeClick:function(t,e,n){},text:function(t,e,n){return t}},margin:{top:0,right:0,bottom:0,left:0},styles:{node:"node",linage:"linage",marriage:"marriage",text:"nodeText"}}),e=this._preprocess(e),a=new t(e.root,e.siblings,r);a.create()},_preprocess:function(t){var e=[],n=0,r={name:"",id:n++,hidden:!0,children:[]},a=function i(t,r){var a={name:t.name,id:n++,hidden:!1,children:[],extra:t.extra,textClass:t.textClass,"class":t["class"]};if(r.children.push(a),t.marriage){var s={name:"",id:n++,hidden:!0,noParent:!0,children:[],extra:t.marriage.extra};r.children.push(s);var o={name:t.marriage.spouse.name,id:n++,hidden:!1,noParent:!0,children:[],textClass:t.marriage.spouse.textClass,"class":t.marriage.spouse["class"],extra:t.marriage.spouse.extra};r.children.push(o),_.forEach(t.marriage.children,function(t){i(t,s)}),e.push({source:{id:a.id},target:{id:o.id}})}};return _.forEach(t,function(t){a(t,r)}),_.forEach(r.children,function(t){t.noParent=!0}),{root:r,siblings:e}}};return e});
//# sourceMappingURL=dTree.min.js.map
